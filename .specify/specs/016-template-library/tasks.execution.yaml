version: "1.0"
feature: template-library
feature_id: "016"
generated: "2026-01-17T00:00:00Z"

execution_constraints:
  model: opus-4.5
  max_parallel_subagents: 10
  default_task_timeout_seconds: 600
  gate_timeout_seconds: 120
  subagent_timeout_seconds: 900

  dispatch_strategy: greedy_queue
  cross_phase_parallelism: true
  greedy_refill: true

  async_background:
    enabled: true
    background_research_tasks: true
    wake_on_complete: true

  batch_sizing:
    prefer_wider_batches: true
    merge_small_batches: true
    max_batch_size: 10

  extended_thinking:
    enabled: true
    ultrathink_for: [architecture, design, complex_logic]

  retry_policy:
    max_attempts: 3
    strategy: exponential
    initial_delay_seconds: 5
    max_delay_seconds: 60
    retry_on: [timeout, rate_limit]
    fail_fast_on: [syntax_error, import_error, type_error]

  circuit_breaker:
    - at_failures: 3
      action: pause_batch
    - at_failures: 5
      action: pause_phase
    - at_failures: 10
      action: abort

  context_per_subagent: 200k

phases:
  - id: phase-1
    name: Setup
    batches:
      - id: "1.1"
        parallel: true
        tasks:
          - id: T001
            description: "Create template browser component directory at src/renderer/components/template-browser/"
            output_file: null
            context_scope:
              - plan.md#project-structure
            timeout_seconds: 180
          - id: T002
            description: "Copy contract schemas from .specify/specs/016-template-library/contracts/template-schemas.ts to src/shared/contracts/template-schemas.ts"
            output_file: src/shared/contracts/template-schemas.ts
            context_scope:
              - contracts/template-schemas.ts
            timeout_seconds: 180
          - id: T003
            description: "Create built-in templates directory at resources/templates/"
            output_file: null
            context_scope:
              - plan.md#project-structure
            timeout_seconds: 180
        gate:
          command: "test -d src/renderer/components/template-browser && test -f src/shared/contracts/template-schemas.ts && test -d resources/templates"
          on_fail: "Verify plan.md project structure; check directory permissions"

  - id: phase-2
    name: Foundational
    depends_on: [phase-1]
    batches:
      - id: "2.1"
        parallel: true
        tasks:
          - id: T004
            description: "Add TEMPLATE_IPC_CHANNEL and TEMPLATE_CREATE_CHANNEL exports to src/shared/ipc-channels.ts"
            output_file: src/shared/ipc-channels.ts
            context_scope:
              - src/shared/ipc-channels.ts
              - contracts/template-schemas.ts
            timeout_seconds: 300
          - id: T005
            description: "Expose template API bindings in src/preload/index.ts (list, get, save, delete, import, export, validate, createFromTemplate)"
            output_file: src/preload/index.ts
            context_scope:
              - src/preload/index.ts
              - contracts/template-schemas.ts
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/shared/ipc-channels.ts src/preload/index.ts 2>&1 | head -20"
          on_fail: "Check contracts/template-schemas.ts imports; verify IPC channel naming convention"

  - id: phase-3
    name: "User Story 1+2 - Template Browser Core"
    depends_on: [phase-2]
    batches:
      - id: "3.1"
        parallel: true
        tasks:
          - id: T006
            description: "Implement template parser with gray-matter in src/renderer/lib/template-parser.ts"
            output_file: src/renderer/lib/template-parser.ts
            context_scope:
              - plan.md#lib
              - research.md#template-parsing
              - data-model.md
              - quickstart.md#parsing-templates
            timeout_seconds: 300
          - id: T007
            description: "Implement variable extraction and substitution in src/renderer/lib/template-variables.ts"
            output_file: src/renderer/lib/template-variables.ts
            context_scope:
              - plan.md#lib
              - research.md#variable-system
              - quickstart.md#variable-substitution
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/lib/template-parser.ts src/renderer/lib/template-variables.ts 2>&1 | head -20"
          on_fail: "Check gray-matter import; verify zod schema imports from contracts"

      - id: "3.2"
        parallel: true
        depends_on: ["3.1"]
        tasks:
          - id: T008
            description: "Implement template-service.ts in src/main/services/template-service.ts with IPC handlers"
            output_file: src/main/services/template-service.ts
            context_scope:
              - plan.md#services
              - contracts/template-schemas.ts
              - research.md#storage
              - src/renderer/lib/template-parser.ts
            timeout_seconds: 600
          - id: T009
            description: "Implement template-store.ts in src/renderer/stores/template-store.ts with Zustand + Immer"
            output_file: src/renderer/stores/template-store.ts
            context_scope:
              - plan.md#stores
              - quickstart.md#zustand-store
              - contracts/template-schemas.ts
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/main/services/template-service.ts src/renderer/stores/template-store.ts 2>&1 | head -20"
          on_fail: "Verify IPC channel registration in main process; check Zustand store pattern"

      - id: "3.3"
        parallel: true
        depends_on: ["3.2"]
        tasks:
          - id: T010
            description: "Implement TemplateCard.tsx in src/renderer/components/template-browser/TemplateCard.tsx"
            output_file: src/renderer/components/template-browser/TemplateCard.tsx
            context_scope:
              - plan.md#components
              - data-model.md#TemplateMetadata
            timeout_seconds: 300
          - id: T011
            description: "Implement TemplateFilters.tsx in src/renderer/components/template-browser/TemplateFilters.tsx"
            output_file: src/renderer/components/template-browser/TemplateFilters.tsx
            context_scope:
              - plan.md#components
              - research.md#search-filter
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/TemplateCard.tsx src/renderer/components/template-browser/TemplateFilters.tsx 2>&1 | head -20"
          on_fail: "Check React component structure; verify props match TemplateMetadata type"

      - id: "3.4"
        parallel: true
        depends_on: ["3.3"]
        tasks:
          - id: T012
            description: "Implement TemplatePreview.tsx in src/renderer/components/template-browser/TemplatePreview.tsx"
            output_file: src/renderer/components/template-browser/TemplatePreview.tsx
            context_scope:
              - plan.md#components
              - spec-003-preview
            timeout_seconds: 300
          - id: T013
            description: "Implement TemplateBrowser.tsx in src/renderer/components/template-browser/TemplateBrowser.tsx"
            output_file: src/renderer/components/template-browser/TemplateBrowser.tsx
            context_scope:
              - plan.md#components
              - research.md#ui-pattern
              - src/renderer/components/template-browser/TemplateCard.tsx
              - src/renderer/components/template-browser/TemplateFilters.tsx
              - src/renderer/components/template-browser/TemplatePreview.tsx
            timeout_seconds: 600
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/TemplatePreview.tsx src/renderer/components/template-browser/TemplateBrowser.tsx 2>&1 | head -20"
          on_fail: "Verify Spec 003 preview component exists; check modal dialog patterns"

      - id: "3.5"
        parallel: false
        depends_on: ["3.4"]
        tasks:
          - id: T014
            description: "Implement VariableDialog.tsx in src/renderer/components/template-browser/VariableDialog.tsx"
            output_file: src/renderer/components/template-browser/VariableDialog.tsx
            context_scope:
              - plan.md#components
              - data-model.md#TemplateVariable
              - src/renderer/lib/template-variables.ts
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/VariableDialog.tsx 2>&1 | head -20"
          on_fail: "Check form component imports; verify TemplateVariable type usage"

      - id: "3.6"
        parallel: true
        depends_on: ["3.5"]
        tasks:
          - id: T015
            description: "Wire up template browser in application shell, connect store to components"
            output_file: null
            context_scope:
              - src/renderer/components/template-browser/
              - src/renderer/stores/template-store.ts
            timeout_seconds: 600
          - id: T016
            description: "Implement Fuse.js search integration in template store"
            output_file: src/renderer/stores/template-store.ts
            context_scope:
              - src/renderer/stores/template-store.ts
              - research.md#search-filter
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/*.tsx src/renderer/stores/template-store.ts 2>&1 | head -20"
          on_fail: "Check component imports; verify store actions are called correctly"

  - id: phase-4
    name: "User Story 3 - Create Custom Template"
    depends_on: [phase-3]
    batches:
      - id: "4.1"
        parallel: true
        tasks:
          - id: T017
            description: "Implement SaveTemplateDialog.tsx in src/renderer/components/template-browser/SaveTemplateDialog.tsx"
            output_file: src/renderer/components/template-browser/SaveTemplateDialog.tsx
            context_scope:
              - plan.md#components
              - data-model.md#Template
              - contracts/template-schemas.ts#TemplateSaveRequest
            timeout_seconds: 300
          - id: T018
            description: "Add variable definition UI to SaveTemplateDialog"
            output_file: src/renderer/components/template-browser/SaveTemplateDialog.tsx
            context_scope:
              - data-model.md#TemplateVariable
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/SaveTemplateDialog.tsx 2>&1 | head -20"
          on_fail: "Check form validation; verify TemplateSaveRequest schema usage"

      - id: "4.2"
        parallel: false
        depends_on: ["4.1"]
        tasks:
          - id: T019
            description: "Wire SaveTemplateDialog to template service, handle duplicate name detection"
            output_file: null
            context_scope:
              - src/renderer/components/template-browser/SaveTemplateDialog.tsx
              - src/main/services/template-service.ts
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/SaveTemplateDialog.tsx src/main/services/template-service.ts 2>&1 | head -20"
          on_fail: "Verify save IPC handler; check MDX validation integration"

  - id: phase-5
    name: "User Story 4 - Manage Custom Templates"
    depends_on: [phase-3]
    batches:
      - id: "5.1"
        parallel: true
        tasks:
          - id: T020
            description: "Add edit template metadata functionality to TemplateBrowser.tsx"
            output_file: src/renderer/components/template-browser/TemplateBrowser.tsx
            context_scope:
              - src/renderer/components/template-browser/TemplateBrowser.tsx
            timeout_seconds: 300
          - id: T021
            description: "Add delete template functionality with confirmation dialog"
            output_file: src/renderer/components/template-browser/TemplateBrowser.tsx
            context_scope:
              - src/renderer/components/template-browser/TemplateBrowser.tsx
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/renderer/components/template-browser/TemplateBrowser.tsx 2>&1 | head -20"
          on_fail: "Check edit/delete actions; verify built-in template protection"

      - id: "5.2"
        parallel: true
        depends_on: ["5.1"]
        tasks:
          - id: T022
            description: "Implement template import flow with file picker"
            output_file: src/main/services/template-service.ts
            context_scope:
              - src/main/services/template-service.ts
              - research.md#file-format
            timeout_seconds: 300
          - id: T023
            description: "Implement template export flow with save dialog"
            output_file: src/main/services/template-service.ts
            context_scope:
              - src/main/services/template-service.ts
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit src/main/services/template-service.ts 2>&1 | head -20"
          on_fail: "Check file dialog integration; verify .mdxt parsing"

  - id: phase-6
    name: "User Story 5 - New File Integration"
    depends_on: [phase-3]
    batches:
      - id: "6.1"
        parallel: true
        tasks:
          - id: T024
            description: "Add 'From Template' option to new file dialog/flow"
            output_file: null
            context_scope:
              - spec-004-file-system
            timeout_seconds: 300
          - id: T025
            description: "Register template commands in command palette"
            output_file: null
            context_scope:
              - spec-005-command-palette
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit 2>&1 | head -30"
          on_fail: "Check command palette registration; verify new file dialog integration"

  - id: phase-7
    name: "Built-in Templates & Polish"
    depends_on: [phase-4, phase-5, phase-6]
    batches:
      - id: "7.1"
        parallel: true
        tasks:
          - id: T026
            description: "Create blog-post.mdxt in resources/templates/"
            output_file: resources/templates/blog-post.mdxt
            context_scope:
              - data-model.md#Template
            timeout_seconds: 180
          - id: T027
            description: "Create documentation.mdxt in resources/templates/"
            output_file: resources/templates/documentation.mdxt
            context_scope:
              - data-model.md#Template
            timeout_seconds: 180
          - id: T028
            description: "Create presentation.mdxt in resources/templates/"
            output_file: resources/templates/presentation.mdxt
            context_scope:
              - data-model.md#Template
            timeout_seconds: 180
          - id: T029
            description: "Create meeting-notes.mdxt in resources/templates/"
            output_file: resources/templates/meeting-notes.mdxt
            context_scope:
              - data-model.md#Template
            timeout_seconds: 180
          - id: T030
            description: "Create tutorial.mdxt in resources/templates/"
            output_file: resources/templates/tutorial.mdxt
            context_scope:
              - data-model.md#Template
            timeout_seconds: 180
        gate:
          command: "test -f resources/templates/blog-post.mdxt && test -f resources/templates/documentation.mdxt && test -f resources/templates/presentation.mdxt && test -f resources/templates/meeting-notes.mdxt && test -f resources/templates/tutorial.mdxt"
          on_fail: "Check .mdxt file format; verify YAML frontmatter structure"

      - id: "7.2"
        parallel: true
        depends_on: ["7.1"]
        tasks:
          - id: T031
            description: "Create unit tests for template-parser.ts in tests/unit/template-parser.test.ts"
            output_file: tests/unit/template-parser.test.ts
            context_scope:
              - src/renderer/lib/template-parser.ts
            timeout_seconds: 300
          - id: T032
            description: "Create unit tests for template-variables.ts in tests/unit/template-variables.test.ts"
            output_file: tests/unit/template-variables.test.ts
            context_scope:
              - src/renderer/lib/template-variables.ts
            timeout_seconds: 300
          - id: T033
            description: "Create integration tests for template IPC in tests/integration/template-ipc.test.ts"
            output_file: tests/integration/template-ipc.test.ts
            context_scope:
              - src/main/services/template-service.ts
              - contracts/template-schemas.ts
            timeout_seconds: 300
        gate:
          command: "npx vitest run tests/unit/template-parser.test.ts tests/unit/template-variables.test.ts --passWithNoTests 2>&1 | tail -10"
          on_fail: "Check test imports; verify vitest configuration"

      - id: "7.3"
        parallel: false
        depends_on: ["7.2"]
        tasks:
          - id: T034
            description: "Create E2E tests for template browser in tests/e2e/template-browser.spec.ts"
            output_file: tests/e2e/template-browser.spec.ts
            context_scope:
              - quickstart.md#e2e-tests
            timeout_seconds: 600
          - id: T035
            description: "Run quickstart.md validation checklist"
            output_file: null
            context_scope:
              - quickstart.md#testing-checklist
            timeout_seconds: 300
        gate:
          command: "npx tsc --noEmit && echo 'Type check passed'"
          on_fail: "Review type errors; check all imports resolve"

dependency_graph:
  edges:
    - from: T004
      to: T002
      type: imports
    - from: T005
      to: T002
      type: imports
    - from: T006
      to: T004
      type: uses
    - from: T007
      to: T004
      type: uses
    - from: T008
      to: T005
      type: uses
    - from: T008
      to: T006
      type: imports
    - from: T009
      to: T008
      type: uses
    - from: T010
      to: T009
      type: uses
    - from: T011
      to: T009
      type: uses
    - from: T012
      to: T009
      type: uses
    - from: T013
      to: T010
      type: imports
    - from: T013
      to: T011
      type: imports
    - from: T013
      to: T012
      type: imports
    - from: T014
      to: T007
      type: uses
    - from: T014
      to: T013
      type: imports
    - from: T015
      to: T014
      type: uses
    - from: T016
      to: T009
      type: extends
    - from: T017
      to: T015
      type: uses
    - from: T019
      to: T017
      type: uses
    - from: T019
      to: T015
      type: uses
    - from: T020
      to: T019
      type: extends
    - from: T021
      to: T019
      type: extends
    - from: T022
      to: T019
      type: extends
    - from: T023
      to: T019
      type: extends
    - from: T024
      to: T015
      type: uses
    - from: T025
      to: T015
      type: uses
    - from: T026
      to: T008
      type: uses
    - from: T031
      to: T006
      type: tests
    - from: T032
      to: T007
      type: tests
    - from: T033
      to: T008
      type: tests
    - from: T034
      to: T015
      type: tests

critical_path:
  tasks: [T002, T004, T006, T008, T009, T013, T014, T015]
  length: 8
  estimated_duration_seconds: 2400

parallelism_analysis:
  total_tasks: 35
  critical_path_length: 8
  parallelism_factor: 4.375
  theoretical_speedup: 4.4x
  practical_speedup: 3.8x
  max_concurrent_subagents: 10
  queue_overflow_capacity: unlimited
  max_parallelism_by_phase:
    phase-1: 3
    phase-2: 2
    phase-3: 4
    phase-4: 2
    phase-5: 2
    phase-6: 2
    phase-7: 5
  cross_phase_execution:
    strategy: interleaved
    independent_phases: [phase-4, phase-5, phase-6]
    example: "US3 + US4 + US5 can share 10 slots after Phase 3"
